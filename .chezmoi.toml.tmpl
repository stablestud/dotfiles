# chezmoi's machine specific config file
#
# Here we determine and setup the required dotfiles for this specific machine
# For example: a server without a (graphical) X server won't require
# qutebrowser dotfiles, so we set a variable here that will be used in
# templates as parameter to exclude those files

{{/* default values, should provide the bare minimum of dotfiles */}}
{{- $headless := true -}}
{{- $battery  := false -}}
{{- $wireless := false -}}

{{/* check if machine has graphical capabilities */}}
{{- if (or (lookPath "X") (lookPath "Xorg")) -}}
	{{- $headless = false -}}
{{- end -}}

{{/* check if machine has a battery */}}
{{- if eq (output "sh" "-c" "test -r /sys/class/power_supply; echo ${?}") ("0") -}}
	{{- if gt (glob "/sys/class/power_supply/{B,b}*" | len) (0) -}}
		{{- $battery = true -}}
	{{- end -}}
{{- end -}}

{{/* check if machine has a wireless NIC */}}
{{- if eq (output "sh" "-c" "test -r /sys/class/net; echo ${?}") ("0") -}}
	{{- range $nic := glob "/sys/class/net/*" -}}
		{{- if (joinPath $nic "/wireless" | lstat) -}}
			{{- $wireless = true -}}
		{{- end -}}
	{{- end -}}
{{- end -}}

# Current machine values detected by chezmoi v{{ .chezmoi.version.version }}
# hostname = {{ .chezmoi.hostname }}
# os       = {{ .chezmoi.os }}
{{- if eq .chezmoi.os "linux" }}
# kernel   = {{ .chezmoi.kernel.ostype }} {{ .chezmoi.kernel.osrelease }} {{ .chezmoi.kernel.version }}
{{- end }}
# arch     = {{ .chezmoi.arch }}
# user     = {{ .chezmoi.username }} ({{ .chezmoi.uid }})
# home     = {{ .chezmoi.homeDir }}

[data]
# whether machine is without graphical environment (X server)
headless = {{ $headless }}
# whether machine has a battery
battery  = {{ $battery }}
# whether machine has a wireless device
wireless = {{ $wireless }}

# vim: filetype=toml
